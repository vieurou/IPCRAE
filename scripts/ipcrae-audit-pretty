#!/bin/bash

# ipcrae-audit-pretty - Wrapper color√© pour ipcrae-audit-check
# Ajoute des ic√¥nes et couleurs pour une meilleure exp√©rience utilisateur

# Couleurs
RESET='\033[0m'
BOLD='\033[1m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'

# Ic√¥nes
CHECK="‚úÖ"
CROSS="‚ùå"
WARNING="‚ö†Ô∏è"
INFO="‚ÑπÔ∏è"
STAR="‚≠ê"
ROBOT="ü§ñ"
GEAR="‚öôÔ∏è"

# Ex√©cuter l'audit original et colorer la sortie
IPCRAE_ROOT="${IPCRAE_ROOT:-${HOME}/IPCRAE}"

# En-t√™te
 echo -e "${BOLD}${CYAN}‚îÅ‚îÅ Audit IPCRAE ${STAR} Am√©lior√© ${STAR} ‚îÅ‚îÅ${RESET}"
 echo -e "${WHITE}Vault: ${PURPLE}$IPCRAE_ROOT${RESET}"
 echo ""

# Ex√©cuter l'audit et traiter la sortie
ipcrae-audit-check | while IFS= read -r line; do
  # Remplacer les checks standards par des ic√¥nes color√©es
  if [[ $line == *"‚úì"* ]]; then
    echo -e "${GREEN}${CHECK}${RESET} ${line#*‚úì }"
  elif [[ $line == *"‚úó"* ]]; then
    echo -e "${RED}${CROSS}${RESET} ${line#*‚úó }"
  elif [[ $line == *"Score Global:"* ]]; then
    # Extraire le score
    score=$(echo "$line" | grep -oP '\d+/\d+')
    echo -e "${BOLD}${line}${RESET}"
    
    # Ajouter un message encourageant
    if [[ $score == "60/60" ]]; then
      echo -e "${GREEN}${ROBOT} ${STAR} Excellent travail ! Score parfait ! ${STAR}${RESET}"
    elif [[ $score =~ ^[5-5][0-9]/60 ]]; then
      echo -e "${BLUE}${ROBOT} Bon travail ! Presque parfait !${RESET}"
    elif [[ $score =~ ^[4-4][0-9]/60 ]]; then
      echo -e "${YELLOW}${ROBOT} Pas mal, mais peut mieux faire !${RESET}"
    else
      echo -e "${RED}${ROBOT} Il faut am√©liorer cela !${RESET}"
    fi
  elif [[ $line == *"GAPS D√âTECT√âS:"* ]]; then
    echo -e "${BOLD}${RED}${line}${RESET}"
  elif [[ $line == *"‚ö†"* ]]; then
    echo -e "${YELLOW}${WARNING}${RESET} ${line#*‚ö†Ô∏è }"
  else
    # Lignes normales
    echo "$line"
  fi
done

echo ""
echo -e "${CYAN}${GEAR} Audit termin√© !${RESET}"